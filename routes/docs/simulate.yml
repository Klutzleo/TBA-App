tags:
  - Combat
summary: Simulate a multi-round combat encounter
description: Runs repeated combat rolls between attacker and defender, returning a round-by-round combat log and final outcome.
consumes:
  - application/json
produces:
  - application/json
parameters:
  - in: body
    name: simulation
    required: true
    schema:
      type: object
      properties:
        attacker:
          type: object
          required:
            - name
            - level
            - stats
            - current_dp
            - weapon
            - armor
          properties:
            name:
              type: string
            stat:
              type: string
              enum: [PP, SP, IP]
            level:
              type: integer
            stats:
              type: object
              properties:
                PP: { type: integer }
                SP: { type: integer }
                IP: { type: integer }
            current_dp:
              type: integer
            weapon:
              type: object
              properties:
                die: { type: string }
                modifier: { type: integer }
            armor:
              type: object
              properties:
                die: { type: string }
                modifier: { type: integer }
            race:
              type: string
            sex:
              type: string
            preferred_stat:
              type: string
            traits:
              type: array
              items: { type: string }
            conditions:
              type: array
              items: { type: string }
            techniques:
              type: array
              items: { type: string }
            magic:
              type: array
              items: { type: string }
        defender:
          type: object
          required:
            - name
            - level
            - stats
            - current_dp
            - weapon
            - armor
          properties:
            name:
              type: string
            stat:
              type: string
              enum: [PP, SP, IP]
            level:
              type: integer
            stats:
              type: object
              properties:
                PP: { type: integer }
                SP: { type: integer }
                IP: { type: integer }
            current_dp:
              type: integer
            weapon:
              type: object
              properties:
                die: { type: string }
                modifier: { type: integer }
            armor:
              type: object
              properties:
                die: { type: string }
                modifier: { type: integer }
            race:
              type: string
            sex:
              type: string
            preferred_stat:
              type: string
            traits:
              type: array
              items: { type: string }
            conditions:
              type: array
              items: { type: string }
            techniques:
              type: array
              items: { type: string }
            magic:
              type: array
              items: { type: string }
        weapon_die:
          type: string
          example: "1d8"
        defense_die:
          type: string
          example: "1d6"
        bap:
          type: boolean
responses:
  200:
    description: Combat simulation result
    schema:
      type: object
      properties:
        type:
          type: string
          example: "combat_simulation"
        rounds:
          type: array
          items:
            type: object
            properties:
              round:
                type: integer
              phases:
                type: array
                items:
                  type: object
                  properties:
                    attacker:
                      type: string
                    defender:
                      type: string
                    attacker_roll:
                      type: integer
                    defender_roll:
                      type: integer
                    outcome:
                      type: string
                    narrative:
                      type: string
                    details:
                      type: object
                      properties:
                        margin:
                          type: integer
                        critical:
                          type: boolean
                        bap_triggered:
                          type: boolean
                        damage:
                          type: integer
                    dp:
                      type: object
                      additionalProperties:
                        type: integer
        final_dp:
          type: object
          additionalProperties:
            type: integer
        final_outcome:
          type: string
          example: "Jason wins by reducing Chump's DP to 0"
        summary:
          type: string
          example: "Jason outlasts Chump in 2 rounds of fierce combat."