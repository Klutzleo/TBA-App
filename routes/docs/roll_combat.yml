tags:
  - Combat
summary: Resolve a combat roll between attacker and defender
description: Compares weapon and defense dice to determine hit, miss, or critical outcome.
consumes:
  - application/json
produces:
  - application/json
parameters:
  - in: body
    name: combat
    required: true
    schema:
      type: object
      properties:
        attacker:
          type: object
          required:
            - name
            - level
            - stats
            - current_dp
            - weapon
            - armor
          properties:
            name:
              type: string
            level:
              type: integer
            stats:
              type: object
              properties:
                PP: { type: integer }
                SP: { type: integer }
                IP: { type: integer }
            current_dp:
              type: integer
            weapon:
              type: object
              properties:
                die: { type: string }
                modifier: { type: integer }
            armor:
              type: object
              properties:
                die: { type: string }
                modifier: { type: integer }
            race:
              type: string
            sex:
              type: string
            preferred_stat:
              type: string
            traits:
              type: array
              items: { type: string }
            conditions:
              type: array
              items: { type: string }
            techniques:
              type: array
              items: { type: string }
            magic:
              type: array
              items: { type: string }
        defender:
          type: object
          required:
            - name
            - level
            - stats
            - current_dp
            - weapon
            - armor
          properties:
            name:
              type: string
            level:
              type: integer
            stats:
              type: object
              properties:
                PP: { type: integer }
                SP: { type: integer }
                IP: { type: integer }
            current_dp:
              type: integer
            weapon:
              type: object
              properties:
                die: { type: string }
                modifier: { type: integer }
            armor:
              type: object
              properties:
                die: { type: string }
                modifier: { type: integer }
            race:
              type: string
            sex:
              type: string
            preferred_stat:
              type: string
            traits:
              type: array
              items: { type: string }
            conditions:
              type: array
              items: { type: string }
            techniques:
              type: array
              items: { type: string }
            magic:
              type: array
              items: { type: string }
        weapon_die:
          type: string
          example: "1d8"
        defense_die:
          type: string
          example: "1d6"
        bap:
          type: boolean
responses:
  200:
    description: Combat roll result
    schema:
      type: object
      properties:
        type:
          type: string
          example: "combat"
        attacker_roll:
          type: integer
          example: 8
        defender_roll:
          type: integer
          example: 3
        outcome:
          type: string
          example: "hit"
        narrative:
          type: string
          example: "Jason lands a devastating strikeâ€”Chump staggers!"
        details:
          type: object
          properties:
            margin:
              type: integer
              example: 5
            critical:
              type: boolean
              example: true
            bap_triggered:
              type: boolean
              example: true